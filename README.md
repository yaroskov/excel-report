# Excel Report

### Ru:

### Содержание:
1. **Контакты**
2. **Описание**
3. **Установка**
4. **Использование**:
   1. _Создание полного отчета_
      1. Подготовка
      2. Опциональные параметры
         1. _Красивые псевдонимы сообщений об ошибке_
         2. _Уникализация похожих ошибок_
         3. _Номер услуги_
      3. Запуск
   2. _Запуск отдельных модулей_ 
5. **Описание конфигурации**

### 1. Контакты:
По любым вопросам обращаться по адресу: **yaroskov@yandex.ru**

С уважением, 

**Ярослав Ковалев**

### 2. Описание:
Данное программное обеспечение используется для формирования отчета из массива логов.

### 3. Установка:
1. Скачайте и установите **Git** с официального сайта: **https://git-scm.com/downloads**
2. Скачайте и установите **Python 3** с официального сайта: **https://www.python.org/downloads/**
3. Откройте консоль **Bash** (в списке установленных программ), которая поставляется вместе с **Git**.
4. Перейдите в нужную вам рабочую директорию с помощью команды **"cd"**, например:
   ```
   mkdir D:\py
   cd D:\py
   ```
5. Склонируйте в целевую директорию репозиторий программы **"Excel Report"** с помощью команды: 
   ```
   git clone git@github.com:yaroskov/excel-report.git
   ```
6. Переименуйте папку **"config_default"** в **"config"**.

### 4. Использование:

Для создания основного полного отчета воспользуйтесь инструкцией **"4.1 Создание полного отчета**".

Раздел **"4.1 Запуск отдельных модулей"** используется в более узконапралвенных целях.

В разделе **"5. Описание конфигурации"** содержится детальное описание параметров в конфигурационных файлах в **config/lib/**:
1. config/config.py
2. config/lib/paths.py
3. config/lib/services.py
4. config/lib/pseudos.py
5. config/lib/unique.py

### 4.1 Создание полного отчета:

1. **Подготовка**:
   1. **Установка.** Выполните установку согласно инструкции выше - **"3. Установка"**;
   2. **Исходный файл с логами.** Создайте файл с логами пригодный для парсинга, для этого:
      1. Получите у **ответственного лица** исходный файл с логами в формате **Excell**.
      2. Откройте исходный **Excel файл** с логами и сохраните только 1 лист, в котором содержатся логи, в формат **htm/html**.
      3. Сохраненный вами файл (в формате **htm/html**) поместите в путь **"excel_report/source/"**.
      4. Пропишите полный путь с наименованием исходного файла в файл **config/lib/paths.py**:
      ```
      paths = {
          ...
          "source": "excel_report/source/source_file.htm",
          ...
      }
      ```
   3. **Выгрузка задач из Jira**:
      1. Сделайте выгрузку задач из системы Jira в формате **html (все поля)**.
      2. Сохраненный вами файл с задачами (в формате **html**) поместите в путь **"excel_report/source/"**.
      3. Пропишите полный путь с наименованием исходного файла в файл **config/lib/paths.py**:
         ```
         paths = {
             ...
             "source": "excel_report/source/source_file.htm",
             ...
         }
         ```
2. **Опциональные параметры**:
   1. **_Красивые псевдонимы сообщений об ошибке_**:
      1. Если вы хотите использовать красивые псевдонимы для месседжей пропишите пары **"msg" - "pseudo"** в файле **config/lib/pseudos.py**:
         ```
         data = [
          {
              "msg": "docType may not be empty",
              "pseudo": "Это псевдоним из листа псевдонимов"
          },
         ]
         ```
      2. В файле **config/config.py** в переменной **options** поставьте значение **usePseudo: True**:
         ```
         options = {
             "usePseudo": True,
             ...
         }
         ```
   2. **_Уникализация похожих ошибок._** В ходе работы вы можете обнаружить, что многие ошибки схожи между собой. В таком случае вам может понадобиться отмечать их как одну и ту же ошибку. Для этого вам понадобится задать **правила уникальности**:
      1. Задайте правила уникальности в файле **"config/lib/unique.py"**:
         ```
         # Для регулярных выражений:
         regex = [
             "[0-9]",
             ...
         ]
         
         # Обрезать после строки:
         split = [
             "MessageId =",
             ...
         ]
         ```
      2. В файле **config/config.py** в переменной **options** поставьте значение **useUnique: True**:
         ```
         options = {
             "useUnique": True,
             ...
         }
         ```
   3. **_Номер услуги._** Если вы хотите, чтобы рядом с наименованием услуги в отчете проставлялся также и ее номер заполните словарь услуг и их номеров:
      1. Пропишите словарь номеров услуг **"config/lib/services.py"**:
         ```
         data = [
         {
             "msg": "Активация корп сим карты от ФЛ",
             "srvice": "666"
         },
         ...
         ]
         ```
      2. В файле **config/config.py** в переменной **options** поставьте значение **useUnique: True**:
         ```
         options = {
             "useServices": True,
             ...
         }
         ```
3. **Запуск**:
   1. Откройте удобную для вас консоль, например "cmd.exe" и выполните:
      ```
      py run_all.py
      ```
   2. Готовый отчет в формате **html** будет собран в папку **"report/"**:
      1. Откройте полученный файл в формате **html** в браузере.
      2. Скопируйте содержимое окна браузера и вставьте в окно офисного приложения для документов, например "Microsoft Word".

### 4.1 Запуск отдельных модулей (устарело, раздел еще редактируется):

3. для начала нужно подготовить список задач из системы Jira, для этого вам потребуется;
   1. в системе Jira выполните поиск задач, задав нужные вам параметры;
   2. сделайте экспорт списка задач выбрав формат "HTML (Все поля)";
   3. расположите данный файл в путь, указанный в файле config.py: tasks->source;
   4. в консоли перейдите в корень с установленной программой, выполните:
   ```
   py run_tasks.py
   ```
   5. пропишите путь к итоговому файлу: в config.py: tasks->list:
   ```
   "tasks": {
        "list": "tasks/results/tasks_27-12-2021_20.05.51.json",
   ```
4. теперь нам сужно построить файл данных для отчета и соотнести их со списком задач из предыдущего пункта:
   1. 
5. Откройте удобную для вас конслоь, например "cmd.exe":
   1. настройте необходимые параметры в "config.py":
      1. 
   2. в файле config.py

### 5. Описание конфигурации (устарело, раздел еще редактируется):

1. Для начала работы вам потребуется настроить программу с помощью конфигурационных файлов:
   1. config.py
   2. pseudos.py
2. config.py - основной файл конфигурации программы, необходим для работы:
   1. В Json объекте "paths" содержатся следующие поля:
      1. results_full - путь к файлу с результатами обработки данных, создается в ходе работы программы;
      2. results_light - см. предыдущий пункт, но не содержит детальную информацию об инцидентах;
      3. results - путь, который вы указываете для создания человеко-читабельного отчета;
      4. source - путь к фалу с исходными данными в формате HTML;
      5. report - путь для сохранения человеко-читабельного отчета;
      6. tasks - набор путей для файлов с задачами системы Jira в формате HTML;
         1. list - результат работы обработчика задач, задается вручную для последующего создания отчета:
         2. source - исходный файл с задачами в формате HTML;
         3. results - путь к папке с результатами обработки задач Jira.
   2. По умолчанию config.py выглядит следующим образом:
   ```
   {
    "results_full": "excel_report/results/full/",
    "results_light": "excel_report/results/light/",
    "results": {
        "ready": "excel_report/results/light/results_light_30-12-2021_03.28.43.json"
    },
    "source": "excel_report/source/source_file.htm",
    "report": "report/",
    "tasks": {
        "list": "tasks/results/tasks_27-12-2021_20.05.51.json",
        "source": "tasks/source/jira.egovdev 2021-12-27T19_57_08+0300.html",
        "results": "tasks/results/"
    }
   }
   ```
3. pseudos.py - файл конфигурации псевдонимов для ошибок:
   1. JSON-объект "data" является массивом субобъектов, содержащих следующие поля:
      1. msg - чообщение или его часть, которому нужно присвоить псевдоним;
      2. pseudo - собственно сам псевдоним, он будет осображаться в отчете вместо сообщеня ошибки.
   2. Файл имеет следующий вид:
   ```
   data = [
	{
		"msg": "docType may not be empty",
		"pseudo": "Это псевдоним из листа псевдонимов"
	},
	{
		"msg": "java.lang.NullPointerException",
		"pseudo": "Некий нуллпоинтер"
	},
	{
		"msg": "Smev3CallError{errorCode=ASYNCH_CALL_ERROR",
		"pseudo": "СМЕВ 3 Асинхронный - ошибки разные, но псевдоним одинаковый"
	}
   ]
   ```
